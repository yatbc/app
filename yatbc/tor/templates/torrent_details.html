{% include 'includes/theme.html' %}
{% load static %}
{% include 'includes/head.html' %}
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
<script src="{% static 'js/details.js' %}"></script>
<script>const globalTorrentId = "{{ torrent_id|escapejs }}";</script>
</head>

<body>

  {% include 'includes/navbar.html' %}

  {% csrf_token %}
  <h1>Torrent details</h1>
  <div x-data="getDetails()">
    {% include 'includes/alert.html' %}
    {% include 'includes/wait.html' %}
    <h2 class="text-break" x-text="torrent.name"></h2>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button"
          role="tab" aria-controls="details" aria-selected="true">Details</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#files" type="button" role="tab"
          aria-controls="files" aria-selected="false">Files</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab"
          aria-controls="logs" aria-selected="false">Logs</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="charts-tab" data-bs-toggle="tab" data-bs-target="#charts" type="button" role="tab"
          aria-controls="charts" aria-selected="false">Chars</button>
      </li>

    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
        <h2>Details:</h2>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Name:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent.name"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Created at:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent.created_at"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Updated at:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="history.updated_at"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Magnet:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent.magnet"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Size:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="formatBytes(torrent.size)"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Total uploaded:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="formatBytes(torrent.total_uploaded)"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Ratio:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="history.ratio"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Type:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent_type.name"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Action on finish:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent_type.action_on_finish"></div>
        </div>
        <div class="row mb-3">
          <div class="col-md-1 col-sm-5 fw-bold text-muted">Target folder for action:</div>
          <div class="col-md-7 col-sm-7 text-break" x-text="torrent_type.target_dir"></div>
        </div>
      </div>
      <div class="tab-pane fade" id="files" role="tabpanel" aria-labelledby="files-tab">
        <h2>Torrent files:</h2>
        {% include 'includes/files.html' %}
      </div>
      <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
        <h2>Logs:</h2>
        {% include 'includes/logs.html' %}
        <button class="btn btn-primary ms-auto" @click="deleteLogs()">Delete logs</button>
      </div>
      <div class="tab-pane fade" id="charts" role="tabpanel" aria-labelledby="charts-tab">
        <h2>Charts</h2>
        {% include 'includes/dragons.html' %}
        <div style="width: 600px; height: 400px;">
          <canvas id="torrentSpeedHistory"></canvas>
        </div>
        <div style="width: 600px; height: 400px;">
          <canvas id="torrentSeedersHistory"></canvas>
        </div>
      </div>

    </div>
</body>

</html>